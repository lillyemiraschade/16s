# 16s Improvement Progress

## Round 1 Summary (20 changes completed)
- All 3 critical DB schema bugs fixed (context column, current_period_end, subscriptions UPDATE RLS)
- credits_remaining default fixed to 50
- Rate limiting added to upload, voice, deploy routes
- Payload size validation on upload + remove-bg
- Credit deduction race condition fixed
- Haiku upgraded to 3.5 for simple iterations
- isSimpleIteration regex patterns tightened
- Cmd+Z no longer hijacks text input undo
- Images restored on request failure
- System prompt: medical/dental + real estate templates added
- System prompt: subjective feedback guide added
- System prompt: null-safe JS patterns across all 10 templates
- System prompt: Google Fonts-only font recommendations
- System prompt: image handling consolidated, CSS compressed, emoji ban deduplicated, spacing deduplicated
- Migration data loss bug fixed in projects.ts
- Client-side preview HTML truncation for bandwidth savings

## Round 2 Completed
- R2-1 [CODE] Extract shared helpers from handleSendMessage/Internal (-53 lines)
- R2-2 [PROMPT] Add law firm template + compress forensic analysis (~400 tokens saved)
- R2-3 [FEATURE] Plan card consistency + first-message intelligence
- R2-4 [CODE] html2canvas CORS fallback with allowTaint retry
- R2-5 [PROMPT] Add fitness/gym template + compress CSS toolkit (~800 tokens saved)
- R2-6 [FEATURE] Contextual pill suggestions by industry
- R2-7 [CODE] Aria-label on image type toggle button
- R2-8 [PROMPT] Church/nonprofit + salon/spa templates, compress pixel-perfect checklist
- R2-9 [FEATURE] Strengthen QA checklist (touch targets, form labels, CLS, external links)
- R2-10 [CODE] Remove dead code + ~25 console.logs from page.tsx, route.ts, projects.ts
- R2-11 [PROMPT] Add automotive + education templates (completes all 6 industry templates)
- R2-12 [FEATURE] Complete context persistence — AI learns+returns preferences
- R2-13 [PROMPT] Multi-request handling + undo/revert flow
- R2-14 [PROMPT] Modern CSS patterns (bento grids, text gradients, scroll animations, etc.)
- R2-15 [CODE] Compress component patterns 230→12 lines (~1500 tokens saved)
- R2-16 [PROMPT] Compress JavaScript patterns 217→12 lines (~1400 tokens saved)
- R2-17 [FEATURE] Improve QA report quality — anti-rubber-stamp example with 7 checks
- R2-18 [CODE] Replace decorative separators + fix last console.logs (~600 tokens saved, now <13K)
- R2-19 [PROMPT] Compress ─── separators + amateur bans section (~700 tokens saved, now ~12.5K)
- R2-20 [FEATURE] Fix React output dark-mode bias + verify context persistence E2E
- R2-21 [CODE] Fix rate limit memory leak in deploy, upload, voice, remove-bg routes
- R2-22 [PROMPT] Compress app/tool examples — recipe code + loading animation (~560 tokens saved, now ~12K)
- R2-23 [FEATURE] Add aria-modal + role=dialog to call disclaimer modal
- R2-24 [CODE] Deduplicate easing curves + hover states in SYSTEM_PROMPT (~50 tokens)
- R2-25 [PROMPT] Compress form example + quality requirements + bg removal (~430 tokens saved, now ~11.5K)
- R2-26 [FEATURE] Add Escape key handlers to edit mode + call disclaimer modal
- R2-27 [CODE] Upgrade AI models to Sonnet 4.5 + Haiku 4.5
- R2-28 [PROMPT] Remove duplicate VISUAL SELF-REVIEW section (~170 tokens saved, now ~11.3K)
- R2-29 [FEATURE] Add a11y to bookmark dialog + welcome screen image toggle aria-labels
- R2-30 [CODE] Fix variable shadowing bug + sanitize PII from error logs
- R2-31 [PROMPT] Compress conversation flow + placeholder sections (~500 tokens saved, now ~10.8K)
- R2-32 [FEATURE] Add aria-labels to PreviewPanel toolbar buttons (viewport, code view, code mode)
- R2-33 [CODE] Remove stack trace logging + downgrade diagnostic console.logs to debug
- R2-34 [PROMPT] Compress 8 industry templates to match concise style (~450 tokens saved, now ~10.3K)
- R2-35 [FEATURE] Add blob upload to handleSendMessageInternal (fixes voice call image bug)
- R2-36 [CODE] Compress design quality intro + forensic analysis (~350 tokens saved, now ~10K)
- R2-37 [PROMPT] Compress aesthetic direction section (~500 tokens saved, now ~9.5K)
- R2-38 [FEATURE] Compress MANDATORY QUALITY CHECK — remove overlap with QA/design system (~400 tokens saved, now ~9.1K)
- R2-39 [CODE] Remove unused errStack variable + unused isReactCode import (dead code cleanup)
- R2-40 [PROMPT] Compress industry-specific functionality blocks to single-line summaries (~400 tokens saved, now ~8.7K)
- R2-41 [FEATURE] Add a11y + Escape key handler to UserMenu dropdown (aria-label, aria-expanded, focus-visible)
- R2-42 [CODE] Add missing aria-labels to ChatPanel + PreviewPanel buttons (Call, New, Edit, Close History, Remove Bookmark)
- R2-43 [PROMPT] Compress FUNCTIONALITY STANDARD section — 6 blocks to 6 compact lines (~350 tokens saved, now ~8.3K)
- R2-44 [FEATURE] Add a11y + Escape key to AuthModal (role=dialog, aria-modal, aria-labelledby, input labels)
- R2-45 [CODE] Extract getUserFriendlyError helper — deduplicate error mapping in stream + outer catch (-20 lines)
- R2-46 [PROMPT] Compress PHASE 3 QUALITY CHECK — visual/image verification + QA report example (~550 tokens saved, now ~7.8K)
- R2-47 [FEATURE] Add aria-label to VoiceCall hangup button + role=menu/menuitem to UserMenu dropdown
- R2-48 [CODE] Remove unused useMemo import + downgrade OAuth console.errors to debug
- R2-49 [PROMPT] Compress PROFESSIONAL COLOR SYSTEM — dark/light/accent modes to single lines (~250 tokens saved, now ~7.5K)
- R2-50 [FEATURE] Disable viewport buttons in PreviewPanel when no preview HTML exists
- R2-51 [CODE] Downgrade 8 client-side console.error/warn to debug (VoiceCall + ChatPanel)
- R2-52 [PROMPT] Merge QUALITY BENCHMARKS into PRE-OUTPUT QUALITY CHECK (~150 tokens saved, now ~7.3K)

## Still Open (Round 2 targets)
- Stripe API version: verified correct for stripe@20.3.0 (not a bug)
- ~~html2canvas CORS handling needs graceful degradation~~ DONE
- ~~beforeunload save doesn't include context for cloud users~~ Already fixed (line 438)
- ~~Missing aria-labels on image toggle buttons~~ DONE
- ~~Industry templates needed: law firms, fitness, churches, salons, automotive, education~~ ALL DONE
- ~~Conversation flow: first-message intelligence, iteration memory, multi-request handling~~ DONE
- ~~Design system: modern CSS patterns, bento grids, glassmorphism~~ DONE
- ~~QA system: touch targets, form labels, CLS prevention, external link attributes~~ DONE (R2-9 checklist + R2-17 report)
- ~~Prompt efficiency: target <13K tokens~~ DONE (~12,529 tokens)
- SMARTER_16S features: ~~plan card consistency~~ DONE (R2-3), ~~QA report quality~~ DONE (R2-17), ~~context persistence~~ verified (R2-20), ~~pill suggestion quality~~ DONE (R2-6)

## In Progress
(none)
