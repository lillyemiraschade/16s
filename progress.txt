# 16s Improvement Progress

## Round 1 Summary (20 changes)
- All 3 critical DB schema bugs fixed
- Rate limiting on all unprotected routes
- Credit enforcement + race condition fix
- Haiku 3.5 upgrade, regex patterns tightened
- System prompt: medical/dental, real estate templates, subjective feedback guide
- System prompt: null-safe JS across all 10 patterns, Google Fonts-only
- System prompt: image handling consolidated, CSS compressed, emoji/spacing deduplicated
- UX: Cmd+Z fix, image restore on failure, client-side preview truncation
- Security: payload validation, migration data loss fix

## Round 2 Summary (44 changes, R2-21 to R2-64)
- handleSendMessage duplication extracted into shared helper
- Stripe API version pinned to stable
- html2canvas CORS graceful degradation
- beforeunload saves context for cloud users
- Aria-labels on image toggles, voice call, user menu, export dropdown, toasts
- Password visibility toggle in AuthModal
- Viewport buttons disabled when no preview
- Copy URL button for deployed sites
- All console.error downgraded to console.debug (clean browser console)
- Dead code removed: unused imports, dead functions in react-preview.ts
- System prompt compressed from ~14K to ~5.9K tokens (58% reduction)
- Compressed: color system, typography, spacing, motion, layout, component patterns, quality benchmarks, a11y rules, fonts, technical requirements

## Still Open (Round 3 targets)
- OUTPUT QUALITY: Generated sites look too samey — need anti-template, anti-vibe-code design rules
- Industry templates: law firms, fitness, churches, salons, automotive, education
- Conversation flow: first-message intelligence, multi-request handling, undo acknowledgment
- Modern design patterns: bento grids, glassmorphism, gradient mesh, scroll-driven animations
- QA checks: touch targets, form labels, CLS prevention, external link rel attributes
- Plan card consistency, QA report quality, context persistence, contextual pills
- Performance: React.memo on heavy components, error boundaries, loading skeletons
- Virtualized message list for long conversations
- Dependency array audits across all hooks
- Keyboard shortcuts help, empty state polish

## Round 3 Progress
- R3-1 [CODE] React.memo on ChatPanel + PreviewPanel, stabilized 5 callback props
- R3-2 [PROMPT] Anti-template design rules + industry design personalities
- R3-3 [FEATURE] Error boundaries for ChatPanel and PreviewPanel
- R3-4 [CODE] useCallback audit — wrapped handleImageUpload + handleImageTypeToggle, no stale closure bugs found
- R3-5 [PROMPT] Designer voice personality + noise/grain + clip-path techniques
- R3-6 [FEATURE] Replaced IDEA_POOL with 30 evocative, design-hinting examples
- R3-7 [CODE] Loading skeleton for initial app hydration
- R3-8 [PROMPT] QA layout diversity check + anti-rubber-stamp report quality rules
- R3-9 [FEATURE] Cleanup guards on 3 async useEffect operations (cancelled flags + clearTimeout)
- R3-10 [CODE] Extract ensureBlobUrls helper from handleSendMessage (-40 lines, 152→112)
- R3-11 [PROMPT] Fix dark-mode bias (industry-aware) + section bg variety rule
- R3-12 [FEATURE] Keyboard shortcut help overlay (Cmd+?, Esc to close)
- R3-13 [CODE] Dedup 3rd blob upload copy in handleSendMessageInternal (-18 lines)
- R3-14 [PROMPT] Fix component style guide dark-mode bias with light/dark variants
- R3-15 [FEATURE] Complex requests (e-commerce, dashboards) now explicitly trigger plan phase
- R3-16 [CODE] Null-guard instructions for JS patterns 7, 8, 10 (completes all 10)
- R3-17 [PROMPT] Copy quality rules — ban generic AI headings, require specific punchy copy
- R3-18 [FEATURE] Contextual pills for 6 more industries (all 12 now covered)
- R3-19 [CODE] Compress INTERACTIVE APPS section (~400 tokens saved)
- R3-20 [PROMPT] Compress PLANNING + BUILDING phases (~200 tokens saved)
- R3-21 [FEATURE] Cmd+K shortcut to focus chat input + overlay entry
- R3-22 [CODE] Remove dead no-op setMessages in handleSendMessage history upload (-7 lines)
- R3-23 [PROMPT] Compress JS PATTERNS + CSS :root block (~200 tokens saved)
- R3-24 [FEATURE] Stop generating button + Escape to cancel in-flight request
- R3-25 [CODE] Clean up orphaned user message on stop + project name in export filename
- R3-26 [PROMPT] Compress HTML GENERATION RULES — remove duplicated placeholder list (~150 tokens)
- R3-27 [FEATURE] Support pasting images from clipboard (Cmd+V)
- R3-28 [CODE] Downgrade 5 console.error → console.debug in projects.ts (completes R2 cleanup)
- R3-29 [PROMPT] Compress SUBJECTIVE FEEDBACK section (~80 tokens saved)

## In Progress
(continuing Round 3)
