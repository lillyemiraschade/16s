# 16s Improvement Progress

## Round 1 Summary (20 changes completed)
- All 3 critical DB schema bugs fixed (context column, current_period_end, subscriptions UPDATE RLS)
- credits_remaining default fixed to 50
- Rate limiting added to upload, voice, deploy routes
- Payload size validation on upload + remove-bg
- Credit deduction race condition fixed
- Haiku upgraded to 3.5 for simple iterations
- isSimpleIteration regex patterns tightened
- Cmd+Z no longer hijacks text input undo
- Images restored on request failure
- System prompt: medical/dental + real estate templates added
- System prompt: subjective feedback guide added
- System prompt: null-safe JS patterns across all 10 templates
- System prompt: Google Fonts-only font recommendations
- System prompt: image handling consolidated, CSS compressed, emoji ban deduplicated, spacing deduplicated
- Migration data loss bug fixed in projects.ts
- Client-side preview HTML truncation for bandwidth savings

## Round 2 Completed
- R2-1 [CODE] Extract shared helpers from handleSendMessage/Internal (-53 lines)
- R2-2 [PROMPT] Add law firm template + compress forensic analysis (~400 tokens saved)
- R2-3 [FEATURE] Plan card consistency + first-message intelligence
- R2-4 [CODE] html2canvas CORS fallback with allowTaint retry
- R2-5 [PROMPT] Add fitness/gym template + compress CSS toolkit (~800 tokens saved)
- R2-6 [FEATURE] Contextual pill suggestions by industry
- R2-7 [CODE] Aria-label on image type toggle button
- R2-8 [PROMPT] Church/nonprofit + salon/spa templates, compress pixel-perfect checklist
- R2-9 [FEATURE] Strengthen QA checklist (touch targets, form labels, CLS, external links)
- R2-10 [CODE] Remove dead code + ~25 console.logs from page.tsx, route.ts, projects.ts
- R2-11 [PROMPT] Add automotive + education templates (completes all 6 industry templates)
- R2-12 [FEATURE] Complete context persistence — AI learns+returns preferences
- R2-13 [PROMPT] Multi-request handling + undo/revert flow
- R2-14 [PROMPT] Modern CSS patterns (bento grids, text gradients, scroll animations, etc.)
- R2-15 [CODE] Compress component patterns 230→12 lines (~1500 tokens saved)
- R2-16 [PROMPT] Compress JavaScript patterns 217→12 lines (~1400 tokens saved)

## Still Open (Round 2 targets)
- Stripe API version: verified correct for stripe@20.3.0 (not a bug)
- ~~html2canvas CORS handling needs graceful degradation~~ DONE
- ~~beforeunload save doesn't include context for cloud users~~ Already fixed (line 438)
- ~~Missing aria-labels on image toggle buttons~~ DONE
- ~~Industry templates needed: law firms, fitness, churches, salons, automotive, education~~ ALL DONE
- ~~Conversation flow: first-message intelligence, iteration memory, multi-request handling~~ DONE
- ~~Design system: modern CSS patterns, bento grids, glassmorphism~~ DONE
- QA system: touch targets, form labels, CLS prevention, external link attributes
- Prompt efficiency: target <13K tokens (currently ~14K)
- SMARTER_16S features: plan card consistency, QA report quality, context persistence verification, pill suggestion quality

## In Progress
(none)
