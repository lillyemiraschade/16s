# Round 12: Performance, Onboarding & Features

## P0-0 — Critical Bug Fix
- [x] 0. Fix blank messages during streaming (delay assistant message creation until content arrives)

## P0 — Performance
- [x] 1. Lazy-load Monaco Editor (next/dynamic) — already done in R11
- [x] 2. Lazy-load html2canvas (dynamic import at call site)
- [x] 3. Lazy-load Stripe client — already clean (only server-side imports)
- [x] 4. Lazy-load VoiceCall component (next/dynamic)
- [x] 5. Bundle analysis: 277 kB → 228 kB first load (-18%), page JS 79.1 kB → 30.7 kB (-61%)

## P1 — Onboarding
- [x] 6. First-visit tooltip tour (2 tooltips: input + pills, localStorage flag, skip/next/got it)
- [x] 7. Welcome screen showcase section (4 gradient placeholder cards)
- [x] 8. Smart first prompt handling (isFirstMessage flag → extra-warm system prompt addendum)
- [x] 9. Credit counter in header (AuthContext fetches credits, UserMenu displays in dropdown + badge)

## P2 — Discussion Mode
- [x] 10. Chat-only toggle (MessageSquare/Code2 button, blue ring indicator, API flag)
- [x] 11. Discussion → Build transition ("Ready to build!" pill auto-switches mode)
- [x] 12. Brainstorm-specific pills (layout options, color palettes, sections, ready to build)

## P3 — Analytics
- [x] 13. Analytics utility (src/lib/analytics.ts — typed events, dev console.debug, prod POST)
- [x] 14. Wire analytics into useChat (message_sent with mode + hasImages)
- [x] 15. Server-side generation metrics (structured console.debug with model, duration, output size)

## P4 — Quality of Life
- [x] 16. Project duplicate (Copy icon button on hover, loads full project, saves with new ID + "(Copy)" name)
- [ ] 17. Export as ZIP
- [ ] 18. Keyboard shortcuts verification

## Log
- R12-1: Fixed streaming blank messages. Root cause: empty assistant placeholder was created immediately, hiding the typing indicator and showing a blank bubble. Fix: delay message creation via `upsertStreamingMsg` helper — message only appears when `extractStreamingMessage` returns non-empty text. Also hardened typing indicator to show when last assistant message has empty content.
- R12-2: Updated SECURITY.md to match current iframe sandbox config.
- R12-3: Lazy-loaded html2canvas (dynamic import at call site in usePreview.ts) and VoiceCall (next/dynamic in page.tsx). Monaco was already lazy, Stripe was already server-only. Result: 277→228 kB first load (-18%).
- R12-8: Project duplicate — Copy button in project card hover actions. Loads full project data, saves with new UUID + "(Copy)" name, inserts into local state immediately.
